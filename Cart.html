<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>Кошница – DomPlus</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial,sans-serif; margin:0; background:#f4f4f4; color:#333; }
header { background:#111; color:white; padding:20px; text-align:center; }
header h1 { font-size:2em; display:inline-block; margin:0; }
.back-btn { font-size:20px; background:#e63946; color:white; border:none; padding:10px 15px; border-radius:5px; cursor:pointer; margin-right:10px; }
.container { max-width:900px; margin:auto; padding:20px; }
.cart-item { display:flex; justify-content:space-between; margin-bottom:10px; align-items:center; background:white; padding:10px; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,0.1);}
.cart-total { font-weight:bold; font-size:18px; margin-top:20px; }
input, select, textarea { width:100%; padding:10px; margin:8px 0; font-size:16px; }
button { background:#1d3557; color:white; border:none; padding:12px 20px; font-size:16px; border-radius:5px; cursor:pointer; }
button:hover { background:#457b9d; }
label { font-weight:bold; display:block; margin-top:10px; }
</style>
</head>
<body>

<header>
<button class="back-btn" onclick="window.location.href='products.html'">← Назад</button>
<h1>Вашата кошница</h1>
</header>

<div class="container">
<div id="cartItems"></div>
<div class="cart-total" id="cartTotal"></div>

<h3>Данни за поръчка</h3>
<form id="orderForm">
<label>Име:</label>
<input type="text" name="Име" required>

<label>Телефон:</label>
<input type="tel" name="Телефон" required>

<label>Адрес:</label>
<input type="text" name="Адрес" required>

<label>Куриерска фирма:</label>
<select name="Куриер" required>
    <option value="">Избери куриер</option>
    <option value="Econt">Econt</option>
    <option value="Speedy">Speedy</option>
    <option value="SPARK">SPARK</option>
</select>

<label>Бележка / допълнителна информация:</label>
<textarea name="Бележка"></textarea>

<button type="submit">Изпрати поръчката</button>
</form>
</div>

<script>
// --- Зареждане на кошницата от localStorage ---
let cart = JSON.parse(localStorage.getItem("cart")) || [];

function renderCart() {
    const cartItems = document.getElementById("cartItems");
    const cartTotal = document.getElementById("cartTotal");
    cartItems.innerHTML = "";
    let total = 0;
    cart.forEach((item,index)=>{
        const div = document.createElement("div");
        div.className = "cart-item";
        div.innerHTML = `
            <span>${item.name} x </span>
            <input type="number" min="1" value="${item.qty}" style="width:60px;" onchange="updateQty(${index},this.value)">
            <span> = ${item.price*item.qty} лв</span>
        `;
        cartItems.appendChild(div);
        total += item.price*item.qty;
    });
    cartTotal.textContent = `Обща цена: ${total} лв`;
}

function updateQty(index,value){
    cart[index].qty = parseInt(value) || 1;
    localStorage.setItem("cart",JSON.stringify(cart));
    renderCart();
}

renderCart();

// --- Submit към Google Form ---
document.getElementById("orderForm").addEventListener("submit",function(e){
    e.preventDefault();
    if(cart.length===0){ alert("Кошницата е празна!"); return; }

    const nameVal = this.querySelector('[name="Име"]').value;
    const phoneVal = this.querySelector('[name="Телефон"]').value;
    const addressVal = this.querySelector('[name="Адрес"]').value;
    const courierVal = this.querySelector('[name="Куриер"]').value;
    const noteVal = this.querySelector('[name="Бележка"]').value;
    const productsText = cart.map(i=>`${i.name} x ${i.qty}`).join(", ");

    fetch("https://docs.google.com/forms/d/e/1NYBLOh4S90ZPxWpaIVCaGY0efo_5a3nUC4mSmCbWvVE/formResponse",{
        method:"POST",
        mode:"no-cors",
        body: new URLSearchParams({
            "entry.520885605": productsText,
            "entry.896637083": nameVal,
            "entry.1626456706": phoneVal,
            "entry.452652446": addressVal,
            "entry.1111111111": courierVal,
            "entry.1628531338": noteVal
        })
    });

    // Pixel tracking (ако има)
    if(typeof fbq!=="undefined") fbq('track','Purchase');
    if(typeof ttq!=="undefined") ttq.track('CompletePayment');

    localStorage.removeItem("cart");
    window.location.href="thank-you.html";
});
</script>

</body>
</html>
