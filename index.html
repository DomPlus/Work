<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>DomPlus – Кошница</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial,sans-serif; margin:0; background:#f4f4f4; color:#333; }
header { background:#111; color:white; padding:20px; text-align:center; }
header h1 { font-size:2em; margin:0; }
.container { max-width:700px; margin:auto; padding:20px; background:white; border-radius:8px; margin-top:20px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
.cart-item { display:flex; justify-content: space-between; margin-bottom:10px; }
.cart-total { font-weight:bold; font-size:18px; margin-top:10px; }
input, select, textarea, button { width:100%; padding:10px; margin:8px 0; font-size:16px; }
button { background:#1d3557; color:white; border:none; border-radius:5px; cursor:pointer; }
button:hover { background:#457b9d; }
</style>
</head>
<body>

<header>
<h1>Вашата кошница</h1>
</header>

<div class="container">
<div id="cartItems"></div>
<div class="cart-total" id="cartTotal">Обща цена: 0 лв</div>

<h3>Данни за поръчка</h3>
<form id="orderForm">
<label>Име:</label>
<input type="text" name="Име" required>

<label>Телефон:</label>
<input type="tel" name="Телефон" required>

<label>Адрес:</label>
<input type="text" name="Адрес" required>

<label>Куриерска фирма:</label>
<select name="Куриер" required>
    <option value="">Избери куриер</option>
    <option value="Econt">Econt</option>
    <option value="Speedy">Speedy</option>
    <option value="SPARK">SPARK</option>
</select>

<label>Бележка / допълнителна информация:</label>
<textarea name="Бележка"></textarea>

<button type="submit">Изпрати поръчката</button>
</form>
</div>

<script>
// ---- JS за кошницата ----
let cart = JSON.parse(localStorage.getItem('cart')||'[]');

function updateCart() {
    const cartItems = document.getElementById("cartItems");
    const cartTotal = document.getElementById("cartTotal");
    cartItems.innerHTML = "";
    let total = 0;
    cart.forEach((item,index)=>{
        const div = document.createElement("div");
        div.className="cart-item";
        div.innerHTML = `<span>${item.name} x ${item.qty} = ${item.price*item.qty} лв</span>
                         <button onclick="removeItem(${index})">✖</button>`;
        cartItems.appendChild(div);
        total += item.price*item.qty;
    });
    cartTotal.textContent = `Обща цена: ${total} лв`;
}

function removeItem(index){
    cart.splice(index,1);
    localStorage.setItem('cart',JSON.stringify(cart));
    updateCart();
}

updateCart();

// ---- JS за submit към Google Form ----
const form = document.getElementById("orderForm");
form.addEventListener("submit",function(e){
    e.preventDefault();
    if(cart.length===0){ alert("Кошницата е празна!"); return; }

    const nameVal = this.querySelector('[name="Име"]').value;
    const phoneVal = this.querySelector('[name="Телефон"]').value;
    const addressVal = this.querySelector('[name="Адрес"]').value;
    const courierVal = this.querySelector('[name="Куриер"]').value;
    const noteVal = this.querySelector('[name="Бележка"]').value;
    const productsText = cart.map(i=>`${i.name} x ${i.qty}`).join(", ");

    fetch("https://docs.google.com/forms/d/e/1NYBLOh4S90ZPxWpaIVCaGY0efo_5a3nUC4mSmCbWvVE/formResponse",{
        method:"POST",
        mode:"no-cors",
        body:new URLSearchParams({
            "entry.520885605": productsText,
            "entry.896637083": nameVal,
            "entry.1626456706": phoneVal,
            "entry.452652446": addressVal,
            "entry.1628531338": noteVal,
            "entry.1111111111": courierVal
        })
    });

    localStorage.removeItem('cart'); // изчиства кошницата
    alert("Поръчката е изпратена успешно!");
    window.location.href="thank-you.html";
});
</script>

</body>
</html>
