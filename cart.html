<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>DomPlus – Кошница</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial,sans-serif;margin:0;background:#f4f4f4;color:#333}
header{background:#111;color:white;padding:30px 15px;text-align:center}
header h1{font-size:2.5em;margin:0}
.container{max-width:800px;margin:auto;padding:20px}
.cart-item{display:flex;align-items:center;background:#fff;margin-bottom:10px;padding:10px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.cart-item img{width:80px;height:60px;object-fit:cover;border-radius:6px;margin-right:10px}
.cart-item-details{flex:1}
.cart-item-details strong{display:block;font-size:16px}
.cart-total{font-size:20px;font-weight:bold;text-align:right;margin-top:10px}
button{background:#1d3557;color:white;border:none;padding:10px 16px;font-size:16px;border-radius:5px;cursor:pointer;margin-top:10px}
button:hover{background:#457b9d}
form{margin-top:20px;background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
form input, form select, form textarea{width:100%;padding:10px;margin:5px 0 15px 0;border-radius:4px;border:1px solid #ccc;font-size:16px}
form button{width:100%}
</style>
</head>
<body>

<header>
<h1>DomPlus – Кошница</h1>
</header>

<div class="container" id="cart-container">
<!-- Продукти в кошницата ще се рендират тук -->
</div>

<div class="container" id="order-form-container" style="display:none;">
<h2>Попълнете информация за поръчката</h2>
<form id="order-form" action="https://docs.google.com/forms/d/e/1FAIpQLSdZEXO7-9dUGkGqOwWVCxuhe9ytA4Io35l0plXtniCAdLRuKQ/formResponse" method="POST" target="_self">
    <label>Име и фамилия</label>
    <input type="text" name="entry.1614692332" required>
    <label>Адрес</label>
    <input type="text" name="entry.1463389063" required>
    <label>Куриерска фирма</label>
    <input type="text" name="entry.142323037" required>
    <label>Свободен текст</label>
    <textarea name="entry.416079699" rows="4"></textarea>
    <input type="hidden" name="entry.696596733" id="total-amount">
    <button type="submit">Изпрати поръчката</button>
</form>
</div>

<script>
// Кошница от localStorage
let cart = JSON.parse(localStorage.getItem("cart")) || [];
const container = document.getElementById("cart-container");

// Рендиране на кошницата
function renderCart(){
    container.innerHTML="";
    if(cart.length===0){
        container.innerHTML="<p style='text-align:center;font-size:20px;'>Кошницата е празна</p>";
        document.getElementById("order-form-container").style.display="none";
        return;
    }
    let total = 0;
    cart.forEach(item=>{
        total += item.price * item.qty;
        const div = document.createElement("div");
        div.className="cart-item";
        div.innerHTML=`
            <img src="${item.image}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/80x60?text=No+Image'">
            <div class="cart-item-details">
                <strong>${item.name}</strong>
                ${item.qty} x ${item.price} лв = ${item.price*item.qty} лв
            </div>
        `;
        container.appendChild(div);
    });
    const totalDiv = document.createElement("div");
    totalDiv.className="cart-total";
    totalDiv.innerText="Общо: " + total + " лв";
    container.appendChild(totalDiv);

    // Покажи формата
    document.getElementById("order-form-container").style.display="block";
    document.getElementById("total-amount").value = total;
}

renderCart();

// Submit на формата без пренасочване
const form = document.getElementById("order-form");
form.addEventListener("submit", function(e){
    e.preventDefault(); // спира стандартното пренасочване

    const data = new FormData(form);
    fetch(form.action, {
        method: "POST",
        mode: "no-cors",
        body: data
    }).then(()=>{
        // Изчиства кошницата
        cart=[];
        localStorage.setItem("cart", JSON.stringify(cart));
        renderCart();

        // Скрива формата
        form.style.display="none";

        // Показва благодарствено съобщение
        const msg = document.createElement("p");
        msg.style.textAlign="center";
        msg.style.fontSize="22px";
        msg.style.marginTop="30px";
        msg.innerText="Благодарим за поръчката! Ще се свържем с вас скоро.";
        form.parentNode.insertBefore(msg, form.nextSibling);
    });
});
</script>

</body>
</html>
